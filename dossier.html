<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" href="icon.png">
  <title>Supers Dossier</title>

  <style>
    @font-face{
      font-family: "m6x11plus";
      src: url("./m6x11plus.ttf") format("truetype");
      font-display: swap;
    }

    :root{
      --bg: #f7f3ea;
      --paper: #fffaf0;
      --paper2: #f1eadc;
      --ink: #1f2328;
      --muted: #5b6470;
      --line: #2b2f36;
      --shadow: #000000;

      --ok: #1a8f5a;
      --warn: #b85b00;
      --bad: #b42318;

      --radius: 6px;

      --mono: "m6x11plus", ui-monospace, monospace;
      --sans: "m6x11plus", ui-monospace, monospace;

      --portrait-frame: 112px;
      --portrait-img: 96px;
      --panel-frame: 220px;
      --panel-img: 160px;
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      font-family: var(--sans);
      color: var(--ink);
      background: var(--bg);
      text-rendering: geometricPrecision;
      -webkit-font-smoothing: none;
      -moz-osx-font-smoothing: auto;
    }

    .app{
      display: grid;
      grid-template-columns: 1fr;
      min-height: 100%;
    }

    .topbar{
      position: sticky;
      top: 0;
      z-index: 20;
      background: var(--paper);
      border-bottom: 2px solid var(--line);
      box-shadow: 4px 4px 0 var(--shadow);
    }

    .topbar-inner{
      max-width: 1220px;
      margin: 0 auto;
      padding: 14px 14px 12px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .title-row{
      display: flex;
      gap: 10px;
      align-items: baseline;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .title{
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .title h1{
      margin: 0;
      font-size: 22px;
      letter-spacing: .5px;
      line-height: 1.1;
    }

    .title .sub{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.2;
    }

    .count-pill{
      font-family: var(--mono);
      font-size: 14px;
      padding: 6px 10px;
      border: 2px solid var(--line);
      background: var(--paper2);
      border-radius: var(--radius);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 3px 3px 0 var(--shadow);
    }

    .dot{
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: rgba(31,35,40,.35);
    }

    .kbd{
      font-family: var(--mono);
      font-size: 13px;
      padding: 1px 6px;
      border: 2px solid var(--line);
      border-bottom-width: 3px;
      border-radius: 4px;
      background: var(--paper2);
      color: var(--ink);
    }

    .controls{
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .control{
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 10px 12px;
      border: 2px solid var(--line);
      border-radius: var(--radius);
      background: var(--paper2);
      box-shadow:
        4px 4px 0 var(--shadow),
        inset 2px 2px 0 rgba(255,255,255,.55),
        inset -2px -2px 0 rgba(0,0,0,.10);
    }

    .control label{
      font-family: var(--mono);
      font-size: 14px;
      color: rgba(31,35,40,.78);
      letter-spacing: 1px;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .control input[type="search"]{
      border: 0;
      outline: none;
      background: transparent;
      width: 100%;
      font-size: 16px;
      color: var(--ink);
      font-family: var(--mono);
    }

    .control input[type="search"]::placeholder{
      color: rgba(91,100,112,.75);
    }

    .content{
      max-width: 1220px;
      width: 100%;
      margin: 0 auto;
      padding: 14px 14px 24px;
    }

    .layout{
      display: grid;
      grid-template-columns: 1fr 390px;
      gap: 14px;
      align-items: start;
    }

    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
    }

    .grid{
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 12px;
    }

    @media (max-width: 1120px){
      .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); }
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    }
    @media (max-width: 620px){
      .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 420px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      position: relative;
      border-radius: var(--radius);
      overflow: hidden;
      border: 2px solid var(--line);
      background: var(--paper);
      box-shadow: 4px 4px 0 var(--shadow);
      cursor: pointer;
      transition: box-shadow .08s steps(2, jump-none);
      min-height: 0;
      --accent: var(--paper2);
    }

    .card:hover{ box-shadow: 3px 3px 0 var(--shadow); }
    .card:active{
      transform: translate(1px, 1px);
      box-shadow: 2px 2px 0 var(--shadow);
    }

    .card.selected{
      outline: 2px solid rgba(31,35,40,.35);
      outline-offset: 2px;
    }

    .portrait{
      position: relative;
      background: var(--paper2);
      border-bottom: 2px solid var(--line);
      display: grid;
      place-items: center;
      padding: 10px;
    }

    .portrait-frame{
      width: var(--portrait-frame);
      height: var(--portrait-frame);
      display: grid;
      place-items: center;
      background: #C8C0B5;
      border: 2px solid rgba(31,35,40,.25);
    }

    .portrait-frame img{
      width: var(--portrait-img);
      height: var(--portrait-img);
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      object-fit: contain;
      background: transparent;
      display: block;
    }

    .portrait-frame .placeholder{
      width: var(--portrait-img);
      height: var(--portrait-img);
      border: 2px dashed rgba(31,35,40,.35);
      background: repeating-linear-gradient(
        45deg,
        rgba(31,35,40,.06),
        rgba(31,35,40,.06) 6px,
        rgba(31,35,40,.02) 6px,
        rgba(31,35,40,.02) 12px
      );
    }

    .card-body{
      padding: 8px 10px 10px;
      display: grid;
      gap: 4px;
    }

    .hero-name{
      margin: 0;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: .4px;
      line-height: 1.1;
      text-transform: uppercase;
    }

    .hero-code{
      font-family: var(--mono);
      font-size: 16px;
      color: rgba(31,35,40,.68);
      letter-spacing: .6px;
      text-transform: uppercase;
    }

    .panel{
      position: sticky;
      top: 98px;
      border-radius: var(--radius);
      overflow: hidden;
      border: 2px solid var(--line);
      background: var(--paper);
      box-shadow: 4px 4px 0 var(--shadow);
      min-height: 520px;
      --accent: var(--paper2);
    }

    @media (max-width: 980px){
      .panel{
        position: fixed;
        inset: 0;
        top: 0;
        border-radius: 0;
        transform: translateY(100%);
        transition: transform .12s steps(3, jump-none);
        z-index: 50;
        min-height: auto;
      }
      .panel.open{ transform: translateY(0); }
    }

    .panel-top{
      padding: 12px;
      border-bottom: 2px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      background: var(--accent);
    }

    .panel-top .badge{
      font-family: var(--mono);
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 6px;
      border: 2px solid var(--line);
      background: var(--paper);
      color: rgba(31,35,40,.9);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 2px 2px 0 var(--shadow);
    }

    .close{
      display: none;
      border: 2px solid var(--line);
      background: var(--paper);
      border-radius: 6px;
      padding: 8px 10px;
      cursor: pointer;
      font-family: var(--mono);
      font-size: 14px;
      box-shadow: 2px 2px 0 var(--shadow);
      color: var(--ink);
    }
    .close:active{
      transform: translate(1px, 1px);
      box-shadow: 1px 1px 0 var(--shadow);
    }
    @media (max-width: 980px){
      .close{ display: inline-flex; }
    }

    .panel-body{
      padding: 12px;
      display: grid;
      gap: 12px;
    }

    .panel-portrait{
      border-radius: var(--radius);
      overflow: hidden;
      border: 2px solid var(--line);
      background: var(--paper2);
      box-shadow: 3px 3px 0 var(--shadow);
      display: grid;
      place-items: center;
      padding: 14px;
    }

    .panel-portrait .portrait-frame{
      width: var(--panel-frame);
      height: var(--panel-frame);
    }

    .panel-portrait img{
      width: var(--panel-img);
      height: var(--panel-img);
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      object-fit: contain;
      display: block;
    }

    .panel-portrait .placeholder{
      width: var(--panel-img);
      height: var(--panel-img);
      border: 2px dashed rgba(31,35,40,.35);
      background: repeating-linear-gradient(
        45deg,
        rgba(31,35,40,.06),
        rgba(31,35,40,.06) 6px,
        rgba(31,35,40,.02) 6px,
        rgba(31,35,40,.02) 12px
      );
    }

    .panel-title{
      display: grid;
      gap: 4px;
    }

    .panel-title h2{
      margin: 0;
      font-size: 18px;
      letter-spacing: .5px;
      line-height: 1.1;
    }

    .panel-title .panel-sub{
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.2;
    }

    .chip{
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 6px;
      border: 2px solid var(--line);
      background: var(--paper2);
      color: var(--ink);
      line-height: 1;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 2px 2px 0 var(--shadow);
    }

    .chip .mini{
      width: 8px;
      height: 8px;
      border-radius: 2px;
      background: rgba(31,35,40,.35);
    }

    .chip.timing .mini{ background: var(--warn); }

    .meta-row{
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .rulebox{
      border: 2px solid var(--line);
      border-radius: var(--radius);
      background: var(--paper2);
      padding: 10px;
      display: grid;
      gap: 8px;
      box-shadow:
        3px 3px 0 var(--shadow),
        inset 2px 2px 0 rgba(255,255,255,.55),
        inset -2px -2px 0 rgba(0,0,0,.10);
    }

    .rulebox .kicker{
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-family: var(--mono);
      font-size: 13px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(31,35,40,.72);
    }

    .rulebox p{
      margin: 0;
      font-size: 15px;
      line-height: 1.2;
      color: rgba(31,35,40,.92);
      white-space: pre-wrap;
    }

    .muted{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.2;
    }

    .empty{
      padding: 12px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.2;
    }

    .card:focus-visible,
    .close:focus-visible,
    input:focus-visible{
      outline: 2px solid rgba(31,35,40,.55);
      outline-offset: 2px;
    }

    .civilian-name{
      font-family: var(--mono);
      font-size: 16px;
      color: rgba(31,35,40,.68);
      letter-spacing: .6px;
      text-transform: none;
    }

    .hero-accent{
      color: var(--accent);
      font-weight: 700;
      text-transform: none;
    }

    .panel-title h2{
      text-transform: uppercase;
    }

  </style>
</head>

<body>
  <div class="app">
    <header class="topbar">
      <div class="topbar-inner">
        <div class="title-row">
          <div class="title">
            <h1>Supers Dossier</h1>
            <div class="sub">Browse profiles and abilities. Use search to quickly find a file.</div>
          </div>

          <div class="count-pill" title="Visible heroes">
            <span class="dot"></span>
            <span id="visibleCount">0</span>/<span id="totalCount">0</span> FILES
          </div>
        </div>

        <div class="controls">
          <div class="control" role="search">
            <label for="q">Search</label>
            <input id="q" type="search" placeholder="Name, codename, ability text…" autocomplete="off" />
          </div>
        </div>
      </div>
    </header>

    <main class="content">
      <div class="layout">
        <section>
          <div class="grid" id="grid"></div>
        </section>

        <aside class="panel" id="panel" aria-live="polite">
          <div class="panel-top">
            <div class="badge">
              <span class="dot"></span>
              <span id="panelId">NO FILE SELECTED</span>
            </div>
            <button class="close" id="closePanel" type="button">Close</button>
          </div>

          <div class="panel-body" id="panelBody">
            <div class="empty">
              Select a hero to open their dossier.<br />
              <span class="muted">Keyboard: <span class="kbd">↑</span> <span class="kbd">↓</span> <span class="kbd">←</span> <span class="kbd">→</span> move · <span class="kbd">Enter</span> open</span>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <script>
    const heroes = [
      { id: "DOSSIER-001", name: "Robert Ellis", codename: "Paragon", timing: "Passive", abilityName: "Unshakable", abilityText: "{HERO} is always good.", note: "\"Ellis remains the program's most reliable stabilizing presence. His integrity has earned our trust.\"\n- Dr. H. Lee", portrait: "Supers/CH-0.png", accent: "#e03434" },
      { id: "DOSSIER-002", name: "Alice Creery", codename: "Mindscape", timing: "Start of Game", abilityName: "Voices in My Head", abilityText: "At the start of the game, {HERO} learns a good Super.\n\nIf they are the villain, instead of lying themselves, their target's information becomes unreliable for the rest of the game.", note: "\"Creery possesses immense psychic potential.\nUnfortunately, it tends to possess her back.\"\n- Dr. H. Lee", portrait: "Supers/CH-1.png", accent: "#6a1f86" },
      { id: "DOSSIER-003", name: "Romeo Farina", codename: "Slipstream", timing: "End of Round", abilityName: "Blink and Miss It", abilityText: "At the end of each round, {HERO} swaps seats with the next movable Super in a clockwise direction.", note: "\"Farina moves at impossible speeds. Though his velocity frequently outpaces his decision-making.\"\n- Dr. H. Lee", portrait: "Supers/CH-2.png", accent: "#222d6e" },
      { id: "DOSSIER-004", name: "Vincent Serrano", codename: "Inferno", timing: "Start of Round", abilityName: "Burn, Baby, Burn", abilityText: "At the start of each round, {HERO} learns whether at least one adjacent remaining Super is a villain.", note: "\"Despite repeated briefings, Serrano continues to treat his pyrokinetic outburst as a solution to all his problems.\"\n- Dr. H. Lee", portrait: "Supers/CH-3.png", accent: "#ff5c50" },
      { id: "DOSSIER-005", name: "Lydia Fortune", codename: "Agent Fortune", timing: "Passive", abilityName: "Luck Be a Lady", abilityText: "If you try to evict {HERO} while they are good, they may dodge the eviction, causing an adjacent Super to be evicted instead.", note: "\"Fortune relies heavily on her probability manipulation, often engaging in risks that would be unacceptable for non-enhanced agents.\"\n- Dr. H. Lee", portrait: "Supers/CH-4.png", accent: "#ac3232" },
      { id: "DOSSIER-006", name: "Kirsten Ashcroft", codename: "Kurse", timing: "Passive", abilityName: "No More...", abilityText: "If you try to evict {HERO} and they are not a villain, you instantly lose all hearts.", note: "\"Ashcroft is highly volatile. Her reality distorting abilities is a constant danger to all.\"\n- Dr. H. Lee", portrait: "Supers/CH-5.png", accent: "#5aff1d" },
      { id: "DOSSIER-007", name: "Cecilia Griffin", codename: "Veil", timing: "Passive", abilityName: "Hidden in Plain Sight", abilityText: "{HERO} cannot be targeted by active abilities.", note: "\"Griffin's invisibility has contributed to a consistently high mission completion rate across covert operations.\"\n- Dr. H. Lee", portrait: "Supers/CH-6.png", accent: "#c1edf6" },
      { id: "DOSSIER-008", name: "[Redacted]", codename: "Masked Detective", timing: "Active", abilityName: "A Crack in the Story", abilityText: "Once per game, {HERO} may choose a Super to investigate and learn whether that Super's most recent information was true or a lie.", note: "[Notes have been redacted or deleted by an unknown party.]", portrait: "Supers/CH-7.png", accent: "#db9a84" },
      { id: "DOSSIER-009", name: "[Unknown]", codename: "Mimic", timing: "Passive", abilityName: "Borrowed Skin", abilityText: "The first time a Super is evicted, {HERO} becomes a copy of that Super, taking their appearance and abilities.", note: "\"Information on her remains limited. She is considered highly dangerous, and is only cooperative when it serves her own interests.\"\n- Dr. H. Lee", portrait: "Supers/CH-8.png", accent: "#306082" },
      { id: "DOSSIER-010", name: "Sibyl Moon", codename: "Oracle", timing: "Start of Game", abilityName: "Visions of Delphi", abilityText: "At the start of the game, {HERO} learns the names of three other Supers, of which one is a villain.", note: "\"Moon operates as an external associate and has proven useful to the agency. Her divination is rarely direct, and there is reason to believe the obscurity is... intentional.\"\n- Dr. H. Lee", portrait: "Supers/CH-9.png", accent: "#8c53de" },
      { id: "DOSSIER-011", name: "Conrad Henry", codename: "Wolfman", timing: "Start of Round", abilityName: "Marked by Scent", abilityText: "At the start of each round, {HERO} learns how many seats away the nearest villain is.", note: "\"Henry demonstrates heightened physical capability under transformation, though control varies with stress and environmental factors.\"\n- Dr. H. Lee", portrait: "Supers/CH-10.png", accent: "#423e39" },
      { id: "DOSSIER-012", name: "CLR-NCE//JUDGE", codename: "CLR-NCE//JUDGE", timing: "Start of Round", abilityName: "By the Numbers", abilityText: "At the start of each round, {HERO} announces the total number of lies told last round.", note: "\"CLR-NCE//JUDGE is an autonomous adjudication unit designed by Dr. Mercer. Programmatic constraints prevent adaptive or contextual decision-making.\"\n- Dr. H. Lee", portrait: "Supers/CH-11.png", accent: "#fbb736" },
      { id: "DOSSIER-013", name: "Colette Charnier", codename: "Copycat", timing: "Passive", abilityName: "What's Yours Is Mine", abilityText: "At the start of the game, {HERO} steals the ability of an adjacent Super.\n\nThat Super loses their power.", note: "\"Leblanc's actions are consistently motivated by personal gain rather than mission objectives. Nevertheless, her ability to absorb and replicate powers has proven valuable to the agency.\"\n- Dr. H. Lee", portrait: "Supers/CH-12.png", accent: "#33304e" },
      { id: "DOSSIER-014", name: "Kieran Dougal", codename: "Omen", timing: "Passive", abilityName: "Bad Company", abilityText: "{HERO} always registers as the villain, even if they are good.", note: "\"Dougal serves as the host for a shadow entity and demonstrates recurrent violent outbursts. Subject's age complicates standard containment procedures.\"\n- Dr. H. Lee", portrait: "Supers/CH-13.png", accent: "#000000" },
      { id: "DOSSIER-015", name: "Charles Bennett", codename: "Viewpoint", timing: "Active", abilityName: "Scene Change", abilityText: "Once per game, {HERO} may choose two Supers and swap their seats when the round ends.", note: "\"Bennett demonstrates reliable teleportation and portal generation abilities. Though he exhibits limited resistance to external influences.\"\n- Dr. H. Lee", portrait: "Supers/CH-14.png", accent: "#323898" },
      { id: "DOSSIER-016", name: "Jack Sullivan", codename: "Strongman", timing: "Passive", abilityName: "The Man Who Can't Be Moved", abilityText: "{HERO} cannot be moved.", note: "\"Sullivan possesses exceptional physical strength. Independent decision-making remains severely limited.\"\n- Dr. H. Lee", portrait: "Supers/CH-15.png", accent: "#45283c" },
      { id: "DOSSIER-017", name: "Marie Hartwell", codename: "Heartstring", timing: "Start of Game", abilityName: "Till Love Do Us Part", abilityText: "{HERO} begin the game paired with a random Super.\n\nIf one of them is a villain, both are villains.\n\nIf both are good, eviction affects both.", note: "\"Despite considerable capability, Hartwell's poor emotional boundaries have led to recurring failures in professional judgment.\"\n- Dr. H. Lee", portrait: "Supers/CH-16.png", accent: "#ff30a4" },
      { id: "DOSSIER-018", name: "Dianne Clatto", codename: "Tempest", timing: "Start of Round", abilityName: "When the Wind Blows", abilityText: "At the start of each round, {HERO} learns whether or not a villain has moved at the end of the last round.", note: "\"Clatto possesses highly destructive weather manipulation powers. Despite that, she demonstrates disciplined control and dependable conduct.\"\n- Dr. H. Lee", portrait: "Supers/CH-17.png", accent: "#59576a" },
      { id: "DOSSIER-019", name: "Sarah Aves", codename: "Songbird", timing: "Start of Round", abilityName: "And the Songbirds Are Singing", abilityText: "At the start of each round, {HERO} learns whether any villain spoke during this round.", note: "\"Aves is better suited to a pop star career but her empathic abilities are occasionally useful in select operational contexts.\"\n- Dr. H. Lee", portrait: "Supers/CH-18.png", accent: "#ff80d7" },
      { id: "DOSSIER-020", name: "G'Rygor", codename: "Watcher", timing: "Start of Round", abilityName: "Look How They Shine", abilityText: "At the start of each round, the {HERO} learns how many villains are still remaining.", note: "\"G'Rygor's role as a so-called cosmic observer puts him beyond any accountability we currently recognize. Caution is advised in all interactions.\"\n- Dr. H. Lee", portrait: "Supers/CH-19.png", accent: "#a8dbf5" },
      { id: "DOSSIER-021", name: "Clara Barton", codename: "Sweet Remedy", timing: "Passive", abilityName: "Lean on Me", abilityText: "When {HERO} is evicted, gain a heart regardless of their alignment.", note: "\"Barton combines trained nursing practice with supernatural healing, though her methods frequently fall outside recognized medical guidelines.\"\n- Dr. H. Lee", portrait: "Supers/CH-20.png", accent: "#fee0e1" },
      { id: "DOSSIER-022", name: "Elias Hale", codename: "Glacier", timing: "Passive", abilityName: "Ice, Ice, Baby", abilityText: "{HERO}'s nearest remaining neighbours can't be moved or swapped.", note: "\"Hale's cryokinetic powers are reliable. Though his excessive ego often lead him to avoidable risk-taking\"\n- Dr. H. Lee", portrait: "Supers/CH-21.png", accent: "#03b8de" },
      { id: "DOSSIER-023", name: "Amber Goulding", codename: "Honeyshot", timing: "Active", abilityName: "Buzzkill", abilityText: "Once per game, {HERO} may choose a Super. If they are a villain, they are immediately evicted. Otherwise, nothing happens.", note: "\"Goulding demonstrates high proficiency in aerial combat, utilizing electrically charged arrows with notable effectiveness. Though her performance is undermined by arrogance and impulsive decision-making\"\n- Dr. H. Lee", portrait: "Supers/CH-22.png", accent: "#fbf236" },
      { id: "DOSSIER-024", name: "Cassie, Polly Shackleton", codename: "Gemini Twins", timing: "Start of Round", abilityName: "Side by Side", abilityText: "At the start of each round, the {HERO} learns whether any two villains are in neighboring seats.", note: "\"The Gemini Twins operate as a unit, with effectiveness heavily dependent on proximity and mutual awareness. Separation significantly degrades reliability.\"\n- Dr. H. Lee", portrait: "Supers/CH-23.png", accent: "#ffd57c" },
      { id: "DOSSIER-025", name: "Julian Anderson", codename: "Showstopper", timing: "Start of Round", abilityName: "Center Stage", abilityText: "At the start of each round, {HERO} learns whether the nearest villain is seated clockwise or counter-clockwise from them.", note: "\"Anderson possesses genuine magical capability, frequently accompanied by unnecessary showmanship and a need for attention.\"\n- Dr. H. Lee", portrait: "Supers/CH-24.png", accent: "#1a1818" },
      { id: "DOSSIER-026", name: "Zelma Delacroix", codename: "Marginalia", timing: "Active", abilityName: "Show Your True Colours", abilityText: "Once per game, {HERO} may choose two Supers to learn whether their alignments are the same or different.", note: "\"While the grimoire remains a powerful asset, Delacroix's persistent anxiety interferes with her ability to reliably access its full power.\"\n- Dr. H. Lee", portrait: "Supers/CH-25.png", accent: "#d15703" },
      { id: "DOSSIER-027", name: "Wu Jin", codename: "Wu Jin", timing: "Start of Round", abilityName: "Balanced Footing", abilityText: "At the start of each round, {HERO} learns whether the nearest remaining villain is seated on an even-numbered seat or an odd-numbered seat.", note: "\"Wu demonstrates a high level of martial proficiency. The full extent of his capability remains unclear.\"\n- Dr. H. Lee", portrait: "Supers/CH-26.png", accent: "#ac3232" },
      { id: "DOSSIER-028", name: "Kai Kalili", codename: "Tidecaller", timing: "Start of Round", abilityName: "Call of the Tide", abilityText: "At the start of each round, {HERO} learns how many seats lie between the two nearest  villains.", note: "\"Kalili demonstrates strong control over his hydrokinetic powers, and especially powerful in maritime environments. Unfortunately, the subject consistently smells like fish.\"\n- Dr. H. Lee", portrait: "Supers/CH-27.png", accent: "#0e9fbd" },
      { id: "DOSSIER-029", name: "Niamh O'Luan", codename: "Aura", timing: "Passive", abilityName: "The Fairies' Lament", abilityText: "If {HERO} is evicted while they are good, their nearest remaining adjacent Supers must reveal their alignment at the start of the next round instead of their normal information.", note: "\"O'Luan's childlike demeanor is poorly suited for field operations, whether genuine or deliberately cultivated.\"\n- Dr. H. Lee", portrait: "Supers/CH-28.png", accent: "#70d4ab" },
      { id: "DOSSIER-030", name: "Sato Enji", codename: "Scarlet Blade", timing: "Start of Round", abilityName: "Blood Price", abilityText: "At the start of each round, the {HERO} reveals a random piece of information.\n\nAt the end of each round, lose a Heart.\n\nYou may evict {HERO} without penalty.", note: "\"Sato's skill with the blade is unquestionable. However, his demonic nature means he cannot be fully trusted.\"\n- Dr. H. Lee", portrait: "Supers/CH-29.png", accent: "#9c1111" },
    ];

    const grid = document.getElementById("grid");
    const panel = document.getElementById("panel");
    const panelBody = document.getElementById("panelBody");
    const panelId = document.getElementById("panelId");
    const q = document.getElementById("q");
    const visibleCount = document.getElementById("visibleCount");
    const totalCount = document.getElementById("totalCount");
    const closePanel = document.getElementById("closePanel");

    totalCount.textContent = String(heroes.length);

    let selectedId = null;

    function matchesSearch(h) {
      const text = (q.value || "").trim().toLowerCase();
      if (!text) return true;

      const abilitySearchText = String(h.abilityText || "").replaceAll("{HERO}", h.codename || "");

      const hay = [
        h.id, h.name, h.codename, h.timing,
        h.abilityName, abilitySearchText, h.note || ""
      ].join(" ").toLowerCase();

      return hay.includes(text);
    }

    function portraitHTML(h, placeholderClass) {
      if (h.portrait && String(h.portrait).trim().length > 0) {
        return `<img src="${escapeAttr(h.portrait)}" alt="${escapeAttr(h.name)} portrait" loading="lazy" />`;
      }
      return `<div class="${placeholderClass}" aria-label="No portrait"></div>`;
    }

    function renderGrid() {
      const filtered = heroes.filter(matchesSearch);
      visibleCount.textContent = String(filtered.length);

      grid.innerHTML = "";
      filtered.forEach((h) => {
        const card = document.createElement("article");
        card.className = "card";
        card.tabIndex = 0;
        card.dataset.id = h.id;

        if (h.id === selectedId) card.classList.add("selected");

        if (h.accent && String(h.accent).trim().length > 0) {
          card.style.setProperty("--accent", h.accent);
        } else {
          card.style.removeProperty("--accent");
        }

        card.innerHTML = `
          <div class="portrait">
            <div class="portrait-frame">
              ${portraitHTML(h, "placeholder")}
            </div>
          </div>
          <div class="card-body">
            <h3 class="hero-name">${escapeHTML(h.codename || "—")}</h3>
            <div class="civilian-name">${escapeHTML(h.name || "")}</div>
            <div class="hero-code">${escapeHTML(h.id)}</div>
          </div>
        `;

        card.addEventListener("click", () => openDossier(h.id));
        card.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            openDossier(h.id);
          }
        });

        grid.appendChild(card);
      });
    }

    function openDossier(id) {
      selectedId = id;
      const h = heroes.find(x => x.id === id);
      if (!h) return;

      [...grid.querySelectorAll(".card")].forEach(el => {
        el.classList.toggle("selected", el.dataset.id === id);
      });

      panelId.textContent = h.id;

      if (h.accent && String(h.accent).trim().length > 0) {
        panel.style.setProperty("--accent", h.accent);
      } else {
        panel.style.removeProperty("--accent");
      }

      panelBody.innerHTML = `
        <div class="panel-portrait">
          <div class="portrait-frame">
            ${portraitHTML(h, "placeholder")}
          </div>
        </div>

        <div class="panel-title">
          <h2>${escapeHTML(h.codename || "—")}</h2>
          <div class="panel-sub">
            <span>${escapeHTML(h.name || "")}</span>
          </div>
        </div>

        <div class="meta-row">
          <span class="chip timing"><span class="mini"></span>${escapeHTML(h.timing || "—")}</span>
        </div>

        <div class="rulebox">
          <div class="kicker">
            <span>Ability</span>
            <span style="opacity:.9;">${escapeHTML(h.abilityName || "—")}</span>
          </div>
          <p>${formatAbilityHTML(h)}</p>
        </div>

        <div class="rulebox">
          <div class="kicker"><span>Notes</span><span style="opacity:.9;">${escapeHTML(h.id)}</span></div>
          <p>${escapeHTML(h.note || "No additional notes.")}</p>
        </div>
      `;

      if (window.matchMedia("(max-width: 980px)").matches) {
        panel.classList.add("open");
      }
    }

    function closeDossier() {
      panel.classList.remove("open");
    }

    function escapeHTML(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function escapeAttr(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll('"', "&quot;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }

    function formatAbilityHTML(h) {
      const raw = String(h.abilityText || "—");
      const safeText = escapeHTML(raw);

      const withHero = safeText.replaceAll(
        "{HERO}",
        `<span class="hero-accent">${escapeHTML(h.codename || "—")}</span>`
      );

      return withHero.replaceAll("\n", "<br />");
    }

    function focusSearchShortcut(e) {
      if (e.key === "/" && document.activeElement !== q) {
        e.preventDefault();
        q.focus();
      }
    }

    function arrowNavigate(e) {
      const cards = [...grid.querySelectorAll(".card")];
      if (!cards.length) return;

      const active = document.activeElement;
      const idx = cards.indexOf(active);
      if (idx === -1) return;

      const cols = getComputedStyle(grid).gridTemplateColumns.split(" ").length;

      let next = idx;
      if (e.key === "ArrowRight") next = Math.min(idx + 1, cards.length - 1);
      if (e.key === "ArrowLeft") next = Math.max(idx - 1, 0);
      if (e.key === "ArrowDown") next = Math.min(idx + cols, cards.length - 1);
      if (e.key === "ArrowUp") next = Math.max(idx - cols, 0);

      if (next !== idx) {
        e.preventDefault();
        cards[next].focus();
      }
    }

    q.addEventListener("input", renderGrid);
    closePanel.addEventListener("click", closeDossier);

    document.addEventListener("keydown", focusSearchShortcut);
    document.addEventListener("keydown", arrowNavigate);

    document.addEventListener("click", (e) => {
      if (!panel.classList.contains("open")) return;
      const clickedInside = panel.contains(e.target);
      const clickedCard = e.target.closest && e.target.closest(".card");
      if (!clickedInside && !clickedCard) closeDossier();
    });

    renderGrid();

    if (heroes.length) {
      openDossier(heroes[0].id);
      const firstCard = grid.querySelector(".card");
      if (firstCard) firstCard.focus({ preventScroll: true });
    }
  </script>
</body>
</html>
